<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <svg id="svg"></svg>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js'></script>
  <script src="../../axiosItem/axiosItem.js"></script>
  <script src="doughnutChart.js"></script>
  <script>
    // 吐回各自可點擊的區塊
    // 滑過會稍微放大
    // 

    // var requestURL = 'C-A0024-001.json';
    // var request = new XMLHttpRequest();
    // request.open('GET', requestURL);
    // request.responseType = 'json';
    // request.send();

    // request.onload = function() {
    //   var superHeroes = request.response;
    //   console.log(superHeroes);
    // }

    window.addEventListener('load', async function () {
      // let transform = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
      // let result = await axiosItem.get('doughnutData.json');
      // console.log(result);
      // let forChart = new doughnutChart();
      // let data     = [];
      // result.data.forEach((value,i)=>{
      //   data.push({
      //     title : transform[i],
      //     unit  : '度',
      //     value  : value.kWh
      //   })
      // })
      // forChart.chart(document.getElementById('svg'),data);
      let data = [{"name":"<5","value":19912018},{"name":"5-9","value":20501982},{"name":"10-14","value":20679786},{"name":"15-19","value":21354481},{"name":"20-24","value":22604232},{"name":"25-29","value":21698010},{"name":"30-34","value":21183639},{"name":"35-39","value":19855782},{"name":"40-44","value":20796128},{"name":"45-49","value":21370368},{"name":"50-54","value":22525490},{"name":"55-59","value":21001947},{"name":"60-64","value":18415681},{"name":"65-69","value":14547446},{"name":"70-74","value":10587721},{"name":"75-79","value":7730129},{"name":"80-84","value":5811429},{"name":"≥85","value":5938752}];
      let color = d3.scaleOrdinal()
    .domain(data.map(d => d.name))
    .range(d3.quantize(t => d3.interpolateSpectral(t * 0.8 + 0.1), data.length).reverse())
    let height = Math.min(width, 500)
    let arc = {
  const radius = Math.min(width, height) / 2;
  return d3.arc().innerRadius(radius * 0.67).outerRadius(radius - 1);
}
      function chart() {

        const arcs = pie(data);

        const svg = d3.create("svg")
          .attr("viewBox", [-width / 2, -height / 2, width, height]);

        svg.selectAll("path")
          .data(arcs)
          .join("path")
          .attr("fill", d => color(d.data.name))
          .attr("d", arc)
          .append("title")
          .text(d => `${d.data.name}: ${d.data.value.toLocaleString()}`);

        svg.append("g")
          .attr("font-family", "sans-serif")
          .attr("font-size", 12)
          .attr("text-anchor", "middle")
          .selectAll("text")
          .data(arcs)
          .join("text")
          .attr("transform", d => `translate(${arc.centroid(d)})`)
          .call(text => text.append("tspan")
            .attr("y", "-0.4em")
            .attr("font-weight", "bold")
            .text(d => d.data.name))
          .call(text => text.filter(d => (d.endAngle - d.startAngle) > 0.25).append("tspan")
            .attr("x", 0)
            .attr("y", "0.7em")
            .attr("fill-opacity", 0.7)
            .text(d => d.data.value.toLocaleString()));

        return svg.node();
      }
    })

  </script>

</body>

</html>